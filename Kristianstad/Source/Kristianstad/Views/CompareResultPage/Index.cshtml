@using Kristianstad.Models.Pages.Compare
@using EPiServer.Editor
@using EPiServer.Security

@model Kristianstad.ViewModels.Compare.CompareResultPageModel

@Html.CssLink("~/Content/compare.css")

<div class="column small-12 medium-12 large-8 content-page content">
    @{
        Html.RenderAction("Breadcrumbs", "MenuKr");
    }
    
    <h1 @Html.EditAttributes(x => x.CurrentPage.PageName)>@Model.CurrentPage.PageName</h1>

    @Html.PropertyFor(x => x.CurrentPage.Description)

    <div class="row">

        <div class="span8 clearfix">
            <div @Html.EditAttributes("ResultQueries")>

                @Html.PropertyFor(x => x.CurrentPage.ResultQueries)

            </div>
        </div>

    </div>

@if (PageEditing.PageIsInEditMode)
{
    <div class="row editor-only-element">

        <h3>Lägg till/ta bort frågor till jämförelsen</h3>

        <div class="span8 clearfix">

            @using (Html.BeginForm("SaveResultQueries", "CompareResultPage"))
            {
                @Html.AntiForgeryToken()

                <ul class="accordion" data-accordion data-multi-expand="true"  data-allow-all-closed="true">

                    @for (int i = 0; i < Model.ResultQueryGroupsFromSources.Count; i++)
                    {
                        <li class="accordion-item accordion-navigation" data-accordion-item>
                            <a href="#panel@(i)" class="accordion-title">@Model.ResultQueryGroupsFromSources[i].Name</a>
                            <div id="panel@(i)" class="accordion-content" data-tab-content>

                                <table>
                                    <thead>
                                        <tr>
                                            <th>Använd</th>
                                            <th>Titel</th>
                                            <th>Id</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        @for (int j = 0; j < Model.ResultQueryGroupsFromSources[i].ResultQueries.Count; j++)
                                        {
                                            <tr>
                                                <td>
                                                    @Html.CheckBoxFor(x => x.ResultQueryGroupsFromSources[i].ResultQueries[j].Use, new { title = Model.ResultQueryGroupsFromSources[i].ResultQueries[j].Use ? "Kryssa ur för att ta bort frågan från jämförelsen" : "Kryssa i för att lägga till frågan till jämförelsen" })
                                                    @Html.HiddenFor(x => x.ResultQueryGroupsFromSources[i].ResultQueries[j].UseBefore)
                                                    @Html.HiddenFor(x => x.ResultQueryGroupsFromSources[i].ResultQueries[j].SourceName)
                                                    @Html.HiddenFor(x => x.ResultQueryGroupsFromSources[i].ResultQueries[j].SourceId)
                                                    @Html.HiddenFor(x => x.ResultQueryGroupsFromSources[i].ResultQueries[j].Name)
                                                </td>
                                                <td>
                                                    @Model.ResultQueryGroupsFromSources[i].ResultQueries[j].Name
                                                </td>
                                                <td>
                                                    @Model.ResultQueryGroupsFromSources[i].ResultQueries[j].SourceId
                                                </td>
                                            </tr>
                                        }

                                    </tbody>
                                </table>

                            </div>

                        </li>
                    }

                </ul>

                <input type="submit" value="Spara frågor" />
            }

        </div>

                        
    </div>
}

</div>

<div class="column content-page right-content small-12 medium-12 large-4">
    @{
        Html.RenderAction("SectionMenu", "MenuKr");
    }

    <div class="block-area">
        @Html.PropertyFor(m => m.CurrentPage.RightBlockArea)
    </div>
</div>

